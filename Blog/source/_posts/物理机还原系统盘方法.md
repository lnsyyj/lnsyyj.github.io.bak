---
title: 物理机还原系统盘方法
date: 2019-04-16 18:57:38
tags: Linux
---

1、单独为/home分区，目的是保留OS备份镜像

```
[root@localhost ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sr0              11:0    1 1024M  0 rom  
vda             252:0    0    9G  0 disk
├─vda1          252:1    0    1G  0 part /boot
├─vda2          252:2    0  4.7G  0 part /
├─vda3          252:3    0  927M  0 part
│ └─centos-swap 253:0    0  924M  0 lvm  [SWAP]
├─vda4          252:4    0    1K  0 part
└─vda5          252:5    0    2G  0 part /home
```

2、备份OS

```
[root@localhost ~]# dd if=/dev/vda2 | gzip > /home/os_backup.img.gz

查看占用空间
[root@localhost ~]# df -Th
Filesystem     Type          Size       Used       Avail    Use%      Mounted on
/dev/vda2      ext4          4.5G       1.1G       3.3G     24%       /
devtmpfs       devtmpfs      3.9G       0          3.9G     0%        /dev
tmpfs          tmpfs         3.9G       0          3.9G     0%        /dev/shm
tmpfs          tmpfs         3.9G       8.6M       3.9G     1%        /run
tmpfs          tmpfs         3.9G       0          3.9G     0%        /sys/fs/cgroup
/dev/vda1      ext4          976M       110M       800M     13%       /boot
/dev/vda5      ext4          2.0G       458M       1.4G     25%       /home
tmpfs          tmpfs         783M       0          783M     0%        /run/user/0

[root@localhost ~]# ll /home/
total 461944
-rw-r--r--. 1 root root 473012800 Apr 16 05:28 os_backup.img.gz
```

3、还原OS

```
[root@localhost ~]# gzip -dc /home/os_backup.img.gz | dd of=/dev/vda2
```

4、重启物理机

```
[root@localhost ~]# reboot
```
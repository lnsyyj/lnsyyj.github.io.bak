<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="XuZNSkAZZ_hygmzGh5A1FylQH9BedoyFXmlYAgj5fd4">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1720709954166786",
    enable_page_level_ads: true
  });
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Jiang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/20/index.html">
<meta property="og:site_name" content="Jiang&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jiang&#39;s Blog">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/20/">





  <title>Jiang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jiang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ads">
          <a href="/ads.txt" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            ads
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/12/UPGRADING-CEPH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiang Yu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/12/UPGRADING-CEPH/" itemprop="url">UPGRADING CEPH</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-12T10:55:29+08:00">
                2019-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SUMMARY"><a href="#SUMMARY" class="headerlink" title="SUMMARY"></a>SUMMARY</h1><p>您可以在群集处于online并in service状态时升级Ceph群集中的daemons！某些类型的daemons依赖于其他daemon。例如，Ceph<br>Metadata Servers和Ceph Object Gateways依赖于Ceph<br>Monitors和Ceph OSD Daemons。我们建议按以下顺序升级：</p>
<p>1、Ceph Deploy</p>
<p>2、Ceph Monitors</p>
<p>3、Ceph OSD Daemons</p>
<p>4、Ceph Metadata Servers</p>
<p>5、Ceph Object Gateways</p>
<p>通常，我们建议升级所有daemons以确保它们都在同一版本上（例如，所有ceph-mon daemons，所有ceph-osd daemons等）。我们还建议您先升级集群中的所有daemons，然后再尝试使用新功能。</p>
<p><a href="https://docs.ceph.com/docs/master/install/upgrading-ceph/#upgrade-procedures" target="_blank" rel="noopener">Upgrade Procedures</a>比较简单，在升级之前需要查看<a href="https://docs.ceph.com/docs/master/releases" target="_blank" rel="noopener">release notes document of your release</a>。基础过程包括三个步骤：</p>
<p>1、 在admin节点上使用ceph-deploy为多个host升级packages（使用ceph-deploy install命令），或者登陆到每个host使用package manager升级Ceph package。例如，在升级Monitors时，ceph-deploy语法可能如下所示： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line"></span><br><span class="line">ceph-deploy install --release firefly mon1 mon2 mon3</span><br></pre></td></tr></table></figure>
<p>注意：ceph-deploy install命令会将指定节点中的packages从旧版本升级到你指定的版本。（该工具不存在ceph-deploy upgrade命令）</p>
<p>2、 登陆到每个Ceph节点，然后重新启动每个Ceph daemon，有关详细信息，请参见<a href="https://docs.ceph.com/docs/master/rados/operations/operating" target="_blank" rel="noopener">Operating a Cluster</a>。</p>
<p>3、 确保您的群集healthy。有关详细信息，请参见<a href="https://docs.ceph.com/docs/master/rados/operations/monitoring" target="_blank" rel="noopener">Monitoring a Cluster</a>。</p>
<p><code>重要说明：升级daemon后，将无法降级。</code></p>
<h1 id="CEPH-DEPLOY"><a href="#CEPH-DEPLOY" class="headerlink" title="CEPH DEPLOY"></a>CEPH DEPLOY</h1><p>在升级Ceph daemons之前，先升级ceph-deploy工具。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -U ceph-deploy</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ceph-deploy</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ceph-deploy python-pushy</span><br></pre></td></tr></table></figure>
<h1 id="UPGRADE-PROCEDURES"><a href="#UPGRADE-PROCEDURES" class="headerlink" title="UPGRADE PROCEDURES"></a>UPGRADE PROCEDURES</h1><p>以下各节描述了升级过程。</p>
<p>重要说明：每个Ceph版本可能都有一些其他步骤。在开始升级daemons之前，请详细阅读<a href="https://docs.ceph.com/docs/master/releases" target="_blank" rel="noopener">release notes document of your release</a>。</p>
<h2 id="UPGRADING-MONITORS"><a href="#UPGRADING-MONITORS" class="headerlink" title="UPGRADING MONITORS"></a>UPGRADING MONITORS</h2><p>要升级monitors，执行以下步骤：</p>
<p>1、为每个daemon instance升级Ceph package。</p>
<p>可以使用ceph-deploy一次指定所有的monitor节点。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line">ceph-deploy install --release hammer mon1 mon2 mon3</span><br></pre></td></tr></table></figure>
<p>你也可以在每个节点上使用<a href="https://docs.ceph.com/docs/master/install/install-storage-cluster/" target="_blank" rel="noopener">distro’s package manager</a>。对于Debian/Ubuntu，在每个主机上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat，执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph</span><br></pre></td></tr></table></figure>
<p>2、重新启动每个monitor，对于Ubuntu</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-mon id=&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ceph restart &#123;mon-id&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat通过ceph-deploy部署的集群，monitor ID通常为mon.{hostname}。</p>
<p>3、确保每个monitor都重新quorum</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mon stat</span><br></pre></td></tr></table></figure>
<p>确保你已完成所有Ceph Monitor的升级步骤。</p>
<h2 id="UPGRADING-AN-OSD"><a href="#UPGRADING-AN-OSD" class="headerlink" title="UPGRADING AN OSD"></a>UPGRADING AN OSD</h2><p>要升级Ceph OSD Daemon，请执行以下步骤：</p>
<p>1、 升级Ceph OSD Daemon package。</p>
<p>可以使用ceph-deploy一次指定所有的monitor节点。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1[ ceph-node2]</span><br><span class="line">ceph-deploy install --release hammer osd1 osd2 osd3</span><br></pre></td></tr></table></figure>
<p>你也可以在每个节点上使用<a href="https://docs.ceph.com/docs/master/install/install-storage-cluster/" target="_blank" rel="noopener">distro’s package manager</a>。对于Debian/Ubuntu，在每个主机上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph</span><br></pre></td></tr></table></figure>
<p>对于CentOS / Red Hat，执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;osd-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph</span><br></pre></td></tr></table></figure>
<p>2、重新启动OSD，其中N是OSD number。对于Ubuntu，请使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-osd id=N</span><br></pre></td></tr></table></figure>
<p>对于主机上的多个OSD，可以使用Upstart重新启动所有OSD。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-osd-all</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ceph restart N</span><br></pre></td></tr></table></figure>
<p>3、确保每个升级的Ceph OSD Daemon都已重新加入集群：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph osd stat</span><br></pre></td></tr></table></figure>
<p>确保你已完成所有Ceph OSD Daemons的升级步骤。</p>
<h2 id="UPGRADING-A-METADATA-SERVER"><a href="#UPGRADING-A-METADATA-SERVER" class="headerlink" title="UPGRADING A METADATA SERVER"></a>UPGRADING A METADATA SERVER</h2><p>要升级Ceph Metadata Server，请执行以下步骤：</p>
<p>1、升级Ceph Metadata Server package。可以使用ceph-deploy一次指定所有的Ceph Metadata Server节点，或在每个节点上使用package manager。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph-deploy install --release &#123;release-name&#125; ceph-node1</span><br><span class="line">ceph-deploy install --release hammer mds1</span><br></pre></td></tr></table></figure>
<p>要手动升级packages，请在每个Debian/Ubuntu节点上执行以下步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;mon-host&#125;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install ceph-mds</span><br></pre></td></tr></table></figure>
<p>或在CentOS/Red Hat节点上执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;mon-host&#125;</span><br><span class="line">sudo yum update &amp;&amp; sudo yum install ceph-mds</span><br></pre></td></tr></table></figure>
<p>2、重新启动metadata server。对于Ubuntu，请使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo restart ceph-mds id=&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于CentOS/Red Hat/Debian，使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ceph restart mds.&#123;hostname&#125;</span><br></pre></td></tr></table></figure>
<p>对于使用ceph-deploy部署的集群，name通常是您在创建时指定的name或hostname。</p>
<p>3、确保metadata server已启动并正在运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mds stat</span><br></pre></td></tr></table></figure>
<h2 id="UPGRADING-A-CLIENT"><a href="#UPGRADING-A-CLIENT" class="headerlink" title="UPGRADING A CLIENT"></a>UPGRADING A CLIENT</h2><p>升级packages并在Ceph集群上重新启动daemons后，我们建议您也升级client节点上的ceph-common和client libraries（librbd1和librados2）。</p>
<p>1、 升级package。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;client-host&#125;</span><br><span class="line">apt-get update &amp;&amp; sudo apt-get install ceph-common librados2 librbd1 python-rados python-rbd</span><br></pre></td></tr></table></figure>
<p>2、确保已升级为新版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph --version</span><br></pre></td></tr></table></figure>
<p>如果没有升级为最新版本，则需要卸载，auto remove dependencies并重新安装。</p>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><h2 id="升级Ceph服务端package"><a href="#升级Ceph服务端package" class="headerlink" title="升级Ceph服务端package"></a>升级Ceph服务端package</h2><h3 id="升级可能带来的影响"><a href="#升级可能带来的影响" class="headerlink" title="升级可能带来的影响"></a>升级可能带来的影响</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）服务端升级可能会影响客户业务，导致业务中断一定时间。如果cephfs或rgw前端有流量（install ceph package时会自动停掉mds与rgw service），请先将升级节点流量先转向其他节点。</span><br><span class="line">（2）如果容器中有ceph client packages，同样需要逐一转走流量，再升级</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.ceph.com/docs/master/releases/nautilus/" target="_blank" rel="noopener">原文</a></p>
<h3 id="UPGRADING-FROM-PRE-LUMINOUS-RELEASES-LIKE-JEWEL"><a href="#UPGRADING-FROM-PRE-LUMINOUS-RELEASES-LIKE-JEWEL" class="headerlink" title="UPGRADING FROM PRE-LUMINOUS RELEASES (LIKE JEWEL)"></a>UPGRADING FROM PRE-LUMINOUS RELEASES (LIKE JEWEL)</h3><p>您必须先升级到Luminous（12.2.z），然后再尝试升级到Nautilus。 另外，您的集群必须在运行Luminous的同时至少完成了所有PG的一次scrub，并在OSD map中设置了recovery_deletes和purged_snapdirs标志。</p>
<h3 id="UPGRADING-FROM-MIMIC-OR-LUMINOUS"><a href="#UPGRADING-FROM-MIMIC-OR-LUMINOUS" class="headerlink" title="UPGRADING FROM MIMIC OR LUMINOUS"></a>UPGRADING FROM MIMIC OR LUMINOUS</h3><p><strong>NOTES</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在从Luminous升级到Nautilus的过程中，将monitors升级到Nautilus后，将无法使用Luminous ceph-osd daemon创建新的OSD。我们建议您避免在升级过程中添加或替换任何OSD。</span><br><span class="line">我们建议您避免在升级过程中创建任何RADOS pools。</span><br><span class="line">您可以使用ceph version(s)命令在每个阶段监视升级进度，该命令将告诉您每种daemon正在运行的ceph版本。</span><br></pre></td></tr></table></figure>
<h3 id="UPGRADE-COMPATIBILITY-NOTES（升级兼容性说明）"><a href="#UPGRADE-COMPATIBILITY-NOTES（升级兼容性说明）" class="headerlink" title="UPGRADE COMPATIBILITY NOTES（升级兼容性说明）"></a>UPGRADE COMPATIBILITY NOTES（升级兼容性说明）</h3><p>这些更改发生在Mimic和Nautilus版本之间。</p>
<ul>
<li><p>ceph pg stat输出已修改为json格式，以匹配ceph df输出：</p>
<ul>
<li>“raw_bytes” field renamed to “total_bytes”</li>
<li>“raw_bytes_avail” field renamed to “total_bytes_avail”</li>
<li>“raw_bytes_avail” field renamed to “total_bytes_avail”</li>
<li>“raw_bytes_used” field renamed to “total_bytes_raw_used”</li>
<li>添加了“total_bytes_used” field 来表示分配给block(slow) device上data objects的（所有OSD）空间</li>
</ul>
</li>
<li><p>ceph df [detail]输出（GLOBAL section）格式进行了修改：</p>
<ul>
<li>新的‘USED’ column显示了分配给block(slow) device上data objects的（所有OSD）空间</li>
<li>现在，‘RAW USED’ 是‘USED’空间与为Ceph目的在块设备上分配/保留的空间之和。BlueStore的BlueFS部分。</li>
</ul>
</li>
</ul>
<h3 id="INSTRUCTIONS（使用说明）"><a href="#INSTRUCTIONS（使用说明）" class="headerlink" title="INSTRUCTIONS（使用说明）"></a>INSTRUCTIONS（使用说明）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">1、如果您的集群最初安装的是Luminous之前的版本，请确保在运行Luminous时集群已完成对所有PG的至少一次完整scrub。否则，将导致您的monitor daemons在启动时拒绝加入quorum，从而使其无法运行。如果不确定Luminous集群是否已完成所有PG的完全scrub，则可以通过运行以下命令检查集群的状态：</span><br><span class="line">ceph osd dump | grep ^flags		(OSD map必须包含recovery_deletes和purged_snapdirs标志)</span><br><span class="line"></span><br><span class="line">如果您的OSD map不包含这两个标志，则只需等待大约24-48小时，在标准群集配置中，应该有充足的时间，以便至少一次scrub所有placement groups，然后重复上述过程 重新检查。</span><br><span class="line">如果您刚刚完成了对Luminous的升级，并且想在短时间内进行升级到Mimic，可以使用shell命令在所有placement groups上强制执行scrub，例如：</span><br><span class="line">ceph pg dump pgs_brief | cut -d &quot; &quot; -f 1 | xargs -n1 ceph pg scrub</span><br><span class="line">您应该考虑到这种强制性scrub可能会对您的Ceph客户的性能产生负面影响。</span><br><span class="line"></span><br><span class="line">2、确保您的群集stable且healthy（没有宕机或无法恢复的OSD）。 （可选，但推荐。）</span><br><span class="line"></span><br><span class="line">3、在升级期间设置noout标志。 （可选，但建议使用。）</span><br><span class="line">ceph osd set noout</span><br><span class="line"></span><br><span class="line">4、通过安装新软件包并重新启动monitor daemons来升级monitors。 例如，在每个monitors主机上，：</span><br><span class="line">systemctl restart ceph-mon.target</span><br><span class="line">所有monitors启动之后，通过在mon map中查找nautilus字符串来验证monitor升级是否完成。 命令：</span><br><span class="line">ceph mon dump | grep min_mon_release</span><br><span class="line">应报告：</span><br><span class="line">min_mon_release 14 (nautilus)</span><br><span class="line">如果不是，则表示尚未升级和重新启动monitors，或者quorum不包括所有monitors。</span><br><span class="line"></span><br><span class="line">5、通过安装新packages并重新启动所有manager daemons来升级ceph-mgr daemons。 例如，在每个manager主机上，：</span><br><span class="line">systemctl restart ceph-mgr.target</span><br><span class="line">请注意，如果您使用的是Ceph Dashboard，则升级ceph-mgr package后可能需要单独安装ceph-mgr-dashboard。ceph-mgr-dashboard的安装脚本将自动为您重新启动manager daemons。 因此，在这种情况下，您可以跳过该步骤以重新启动daemons。</span><br><span class="line">通过检查ceph -s来验证ceph-mgr daemons是否正在运行：</span><br><span class="line"># ceph -s</span><br><span class="line">...</span><br><span class="line">  services:</span><br><span class="line">   mon: 3 daemons, quorum foo,bar,baz</span><br><span class="line">   mgr: foo(active), standbys: bar, baz</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">6、通过安装新packages并在所有OSD主机上重新启动ceph-osd daemons来升级所有OSD：</span><br><span class="line">systemctl restart ceph-osd.target</span><br><span class="line">您可以使用ceph versions或ceph osd versions命令监视OSD升级的进度：</span><br><span class="line"># ceph osd versions</span><br><span class="line">&#123;</span><br><span class="line">   &quot;ceph version 13.2.5 (...) mimic (stable)&quot;: 12,</span><br><span class="line">   &quot;ceph version 14.2.0 (...) nautilus (stable)&quot;: 22,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">7、如果集群中通过ceph-disk部署了OSD（例如，几乎所有在Mimic版本之前创建的OSD），您都需要让ceph-volume承担启动daemons的责任。 在包含OSD的每个主机上，确保OSD当前正在运行，然后：</span><br><span class="line">ceph-volume simple scan   （所有使用ceph-disk创建的并正在运行的OSDs，从OSD data partition或directory中捕获元数据）</span><br><span class="line">ceph-volume simple activate --all （使systemd units可以mount已配置的devices，并启动Ceph OSD）</span><br><span class="line">我们建议按照此步骤重新启动每个OSD主机，以验证OSD是否自动启动。</span><br><span class="line">请注意，ceph-volume不具有与ceph-disk相同的hot-plug功能，后者通过udev events自动检测到新连接的磁盘。如果运行上述scan命令时OSD当前未running，或者将基于ceph-disk的OSD移至新主机，或者重新安装了主机OSD，或者/etc/ceph/osd目录丢失， 您将需要显式扫描每个ceph-disk OSD的主数据分区。例如，：</span><br><span class="line">ceph-volume simple scan /dev/sdb1</span><br><span class="line">输出将包括相应的ceph-volume simple activate命令以启用OSD。</span><br><span class="line"></span><br><span class="line">8、升级所有CephFS MDS daemons。 对于每个CephFS file system，</span><br><span class="line">	8.1	将ranks数减少到1。（如果您打算稍后还原它，请首先记录MDS守护程序的原始数量）：</span><br><span class="line">	ceph status</span><br><span class="line">	ceph fs set &lt;fs_name&gt; max_mds 1</span><br><span class="line">	8.2 通过定期检查状态，等待集群停用所有non-zero ranks：</span><br><span class="line">	ceph status</span><br><span class="line">	8.3 使用以下命令使所有standby MDS daemons在适当的主机上offline：</span><br><span class="line">	systemctl stop ceph-mds@&lt;daemon_name&gt;</span><br><span class="line">	8.4 确认只有一个MDS处于online，并且您的FS的rank 0：</span><br><span class="line">	ceph status</span><br><span class="line">	8.5 通过安装新packages并重新启动daemon来升级剩余的MDS daemon：</span><br><span class="line">	systemctl restart ceph-mds.target</span><br><span class="line">	</span><br><span class="line">	8.6 重新启动所有已offline的standby MDS daemons</span><br><span class="line">	systemctl start ceph-mds.target</span><br><span class="line">	</span><br><span class="line">	8.7 恢复该volume的max_mds原始值：</span><br><span class="line">	ceph fs set &lt;fs_name&gt; max_mds &lt;original_max_mds&gt;</span><br><span class="line">	</span><br><span class="line">9、通过升级packages并在所有主机上重新启动daemons来升级所有radosgw daemons：</span><br><span class="line">systemctl restart ceph-radosgw.target</span><br><span class="line"></span><br><span class="line">10、禁用Nautilus之前的OSD并启用所有Nautilus的新功能来完成升级：</span><br><span class="line">ceph osd require-osd-release nautilus</span><br><span class="line"></span><br><span class="line">11、如果您一开始设置noout，请确保清除它：</span><br><span class="line">ceph osd unset noout</span><br><span class="line"></span><br><span class="line">12、使用ceph health验证集群是否healthy</span><br><span class="line">如果您的CRUSH tunables（可调参数）早于Hammer，Ceph现在将发出健康警告。 如果您看到有这种效果的健康警报，则可以使用以下方法还原此更改：</span><br><span class="line">ceph config set mon mon_crush_min_required_version firefly</span><br><span class="line">但是，如果Ceph没有警报，那么我们建议您也将所有现有的CRUSH buckets都切换到straw2，这是Hammer版本中重新添加的。如果您有任何“straw” buckets，这将导致少量的数据移动，但通常不会太严重。</span><br><span class="line">ceph osd getcrushmap -o backup-crushmap</span><br><span class="line">ceph osd crush set-all-straw-buckets-to-straw2</span><br><span class="line">如果有问题，您可以还原：</span><br><span class="line">ceph osd setcrushmap -i backup-crushmap</span><br><span class="line">移至“straw2” buckets将解锁一些最新功能，例如在Luminous中crush-compat balancer mode（https://docs.ceph.com/docs/master/rados/operations/balancer/#balancer）。</span><br><span class="line"></span><br><span class="line">13、要启用新的 v2 network protocol，请发出以下命令：</span><br><span class="line">ceph mon enable-msgr2</span><br><span class="line">指示所有与旧版v1 protocol绑定到旧的默认端口6789的monitors，同时也绑定到新的3300 v2 protocol端口。要查看是否所有monitors都已更新，请执行以下操作：</span><br><span class="line">ceph mon dump</span><br><span class="line">并确认每个monitors都显示v2:和v1:地址。</span><br><span class="line"></span><br><span class="line">14、对于已升级的每个主机，应更新ceph.conf文件，使其不指定monitor端口（如果您在默认端口上运行monitor），或者显式引用v2和v1地址和端口。 如果仅列出了v1 IP和端口，则一切仍将起作用，但是在得知monitor也使用v2协议后，每个CLI实例或daemon都将需要重新连接，这会减慢速度并阻止完全过渡到v2协议。</span><br><span class="line">这也是将ceph.conf中的所有配置选项完全转换到集群的配置数据库中的好时机。 在每个主机上，您可以使用以下命令通过以下命令将所有选项导入monitor：</span><br><span class="line">ceph config assimilate-conf -i /etc/ceph/ceph.conf</span><br><span class="line">您可以通过以下方式查看集群的配置数据库：</span><br><span class="line">ceph config dump</span><br><span class="line">要为每个主机创建一个最小但足够的ceph.conf，请执行以下操作：</span><br><span class="line">ceph config generate-minimal-conf &gt; /etc/ceph/ceph.conf.new</span><br><span class="line">mv /etc/ceph/ceph.conf.new /etc/ceph/ceph.conf</span><br><span class="line">确保仅在已升级到Nautilus的主机上使用此新配置，因为它可能包含mon_host值，该值包含Nautilus能理解的IP地址的新v2:和v1:前缀。</span><br><span class="line">有关更多信息，请参阅https://docs.ceph.com/docs/master/rados/configuration/msgr2/#msgr2-ceph-conf</span><br><span class="line"></span><br><span class="line">15、考虑启用telemetry module以将匿名使用情况统计信息和崩溃信息发送给Ceph upstream developers。 查看将要报告的内容（实际上没有向任何人发送任何信息），请执行以下操作：</span><br><span class="line">ceph mgr module enable telemetry</span><br><span class="line">ceph telemetry show</span><br><span class="line">如果您对所报告的数据感到满意，则可以选择使用以下方法自动报告high-level cluster metadata：</span><br><span class="line">ceph telemetry on</span><br><span class="line">有关telemetry module的更多信息，请参见文档：https://docs.ceph.com/docs/master/mgr/telemetry/#telemetry</span><br></pre></td></tr></table></figure>
<p>1、查看当前环境与版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph -v</span><br><span class="line">ceph version 12.2.12 (1436006594665279fe734b4c15d7e08c13ebd777) luminous (stable)</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# uname -a</span><br><span class="line">Linux ceph2 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph2(active), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs-1/1/1 up  &#123;0=ceph1=up:active&#125;, 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">    rgw: 3 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 244 objects, 5.27KiB</span><br><span class="line">    usage:   6.04GiB used, 293GiB / 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"> </span><br><span class="line">  io:</span><br><span class="line">    client:   2.00KiB/s rd, 0B/s wr, 1op/s rd, 1op/s wr</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph osd tree</span><br><span class="line">ID CLASS WEIGHT  TYPE NAME      STATUS REWEIGHT PRI-AFF </span><br><span class="line">-1       0.29214 root default                           </span><br><span class="line">-5       0.09738     host ceph1                         </span><br><span class="line"> 1   hdd 0.04869         osd.1      up  1.00000 1.00000 </span><br><span class="line"> 4   hdd 0.04869         osd.4      up  1.00000 1.00000 </span><br><span class="line">-7       0.09738     host ceph2                         </span><br><span class="line"> 2   hdd 0.04869         osd.2      up  1.00000 1.00000 </span><br><span class="line"> 5   hdd 0.04869         osd.5      up  1.00000 1.00000 </span><br><span class="line">-3       0.09738     host ceph3                         </span><br><span class="line"> 0   hdd 0.04869         osd.0      up  1.00000 1.00000 </span><br><span class="line"> 3   hdd 0.04869         osd.3      up  1.00000 1.00000 </span><br><span class="line"> </span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep ceph</span><br><span class="line">libcephfs2-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-common-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-base-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-osd-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mds-12.2.12-0.el7.x86_64</span><br><span class="line">python-cephfs-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mon-12.2.12-0.el7.x86_64</span><br><span class="line">ceph-mgr-12.2.12-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rbd</span><br><span class="line">python-rbd-12.2.12-0.el7.x86_64</span><br><span class="line">librbd1-12.2.12-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rados</span><br><span class="line">ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">librados2-12.2.12-0.el7.x86_64</span><br><span class="line">python-rados-12.2.12-0.el7.x86_64</span><br><span class="line">libradosstriper1-12.2.12-0.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>2、修改每台ceph节点的ceph mirror，L版地址修改为N版地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# vim /etc/yum.repos.d/ceph_stable.repo </span><br><span class="line">[ceph_stable]</span><br><span class="line">baseurl = http://mirrors.163.com/ceph/rpm-nautilus/el7/$basearch</span><br><span class="line">gpgcheck = 1</span><br><span class="line">gpgkey = http://mirrors.163.com/ceph/keys/release.asc</span><br><span class="line">name = Ceph Stable repo</span><br></pre></td></tr></table></figure>
<p>3、设置noout 标志停机维护</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph osd set noout</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1/1/1 up  &#123;0=ceph2=up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB / 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<p>4、升级每台ceph节点的 ceph packages（一个节点一个节点的升）</p>
<p>升级顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、Ceph Monitors</span><br><span class="line">2、Ceph Mgr</span><br><span class="line">3、Ceph OSD Daemons</span><br><span class="line">4、Ceph Metadata Servers</span><br><span class="line">5、Ceph Object Gateways</span><br></pre></td></tr></table></figure>
<p>升级命令（<code>注意：安装过程中rgw与mds服务会自动被stop</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# yum install ceph</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">epel/x86_64/metalink                                                                                                                                                                                                  | 6.5 kB  00:00:00     </span><br><span class="line"> * base: mirrors.huaweicloud.com</span><br><span class="line"> * epel: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.huaweicloud.com</span><br><span class="line">base                                                                                                                                                                                                                  | 3.6 kB  00:00:00     </span><br><span class="line">ceph_stable                                                                                                                                                                                                           | 2.9 kB  00:00:00     </span><br><span class="line">epel                                                                                                                                                                                                                  | 5.3 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                                                                                                | 2.9 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                                                                                               | 2.9 kB  00:00:00     </span><br><span class="line">(1/8): epel/x86_64/group_gz                                                                                                                                                                                           |  88 kB  00:00:00     </span><br><span class="line">(2/8): ceph_stable/x86_64/primary_db                                                                                                                                                                                  | 192 kB  00:00:01     </span><br><span class="line">(3/8): base/7/x86_64/group_gz                                                                                                                                                                                         | 165 kB  00:00:01     </span><br><span class="line">(4/8): epel/x86_64/updateinfo                                                                                                                                                                                         | 1.0 MB  00:00:02     </span><br><span class="line">(5/8): extras/7/x86_64/primary_db                                                                                                                                                                                     | 152 kB  00:00:01     </span><br><span class="line">(6/8): base/7/x86_64/primary_db                                                                                                                                                                                       | 6.0 MB  00:00:04     </span><br><span class="line">(7/8): updates/7/x86_64/primary_db                                                                                                                                                                                    | 1.9 MB  00:00:05     </span><br><span class="line">(8/8): epel/x86_64/primary_db                                                                                                                                                                                         | 6.9 MB  00:00:16     </span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph.x86_64 2:14.2.4-0.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: ceph-osd = 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mds = 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mgr = 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-mon = 2:14.2.4-0.el7 for package: 2:ceph-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-mds.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mds.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: ceph-base = 2:14.2.4-0.el7 for package: 2:ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librdmacm.so.1()(64bit) for package: 2:ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-mgr.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mgr.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: python-bcrypt for package: 2:ceph-mgr-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-mon.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-mon.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package ceph-osd.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-osd.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt for package: 2:ceph-osd-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-base.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">--&gt; Processing Dependency: ceph-base = 2:12.2.12-0.el7 for package: 2:ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-base = 2:12.2.12-0.el7 for package: 2:ceph-selinux-12.2.12-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-base = 2:12.2.12-0.el7 for package: 2:ceph-radosgw-12.2.12-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-base.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: librados2 = 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libcephfs2 = 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librgw2 = 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librbd1 = 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: ceph-common = 2:14.2.4-0.el7 for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.10.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.12.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0(LIBOATH_1.2.0)(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: liboath.so.0()(64bit) for package: 2:ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package librdmacm.x86_64 0:22.1-3.el7 will be installed</span><br><span class="line">---&gt; Package libstoragemgmt.x86_64 0:1.7.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt-python for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libyajl.so.2()(64bit) for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libconfig.so.9()(64bit) for package: libstoragemgmt-1.7.3-3.el7.x86_64</span><br><span class="line">---&gt; Package python2-bcrypt.x86_64 0:3.1.6-2.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-cffi for package: python2-bcrypt-3.1.6-2.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python2-six for package: python2-bcrypt-3.1.6-2.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ceph-common.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-common.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: libradosstriper1 = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-cephfs = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rbd = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-ceph-argparse = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rados = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: python-rgw = 2:14.2.4-0.el7 for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: librabbitmq.so.4()(64bit) for package: 2:ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package ceph-radosgw.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-radosgw.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package ceph-selinux.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package ceph-selinux.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">--&gt; Processing Dependency: selinux-policy-base &gt;= 3.13.1-229.el7_6.15 for package: 2:ceph-selinux-14.2.4-0.el7.x86_64</span><br><span class="line">---&gt; Package libcephfs2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package libcephfs2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libconfig.x86_64 0:1.4.9-5.el7 will be installed</span><br><span class="line">---&gt; Package liboath.x86_64 0:2.6.2-1.el7 will be installed</span><br><span class="line">---&gt; Package librados2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librados2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package librbd1.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librbd1.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package librgw2.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package librgw2.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libstoragemgmt-python.noarch 0:1.7.3-3.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: libstoragemgmt-python-clibs for package: libstoragemgmt-python-1.7.3-3.el7.noarch</span><br><span class="line">---&gt; Package python-cffi.x86_64 0:1.6.0-5.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-pycparser for package: python-cffi-1.6.0-5.el7.x86_64</span><br><span class="line">---&gt; Package python2-six.noarch 0:1.9.0-0.el7 will be installed</span><br><span class="line">---&gt; Package yajl.x86_64 0:2.0.4-4.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package librabbitmq.x86_64 0:0.8.0-2.el7 will be installed</span><br><span class="line">---&gt; Package libradosstriper1.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package libradosstriper1.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package libstoragemgmt-python-clibs.x86_64 0:1.7.3-3.el7 will be installed</span><br><span class="line">---&gt; Package python-ceph-argparse.x86_64 2:14.2.4-0.el7 will be installed</span><br><span class="line">---&gt; Package python-cephfs.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-cephfs.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-pycparser.noarch 0:2.14-1.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: python-ply for package: python-pycparser-2.14-1.el7.noarch</span><br><span class="line">---&gt; Package python-rados.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rados.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-rbd.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rbd.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package python-rgw.x86_64 2:12.2.12-0.el7 will be updated</span><br><span class="line">---&gt; Package python-rgw.x86_64 2:14.2.4-0.el7 will be an update</span><br><span class="line">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-229.el7 will be updated</span><br><span class="line">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-252.el7.1 will be an update</span><br><span class="line">--&gt; Processing Dependency: selinux-policy = 3.13.1-252.el7.1 for package: selinux-policy-targeted-3.13.1-252.el7.1.noarch</span><br><span class="line">--&gt; Processing Dependency: selinux-policy = 3.13.1-252.el7.1 for package: selinux-policy-targeted-3.13.1-252.el7.1.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package python-ply.noarch 0:3.4-11.el7 will be installed</span><br><span class="line">---&gt; Package selinux-policy.noarch 0:3.13.1-229.el7 will be updated</span><br><span class="line">---&gt; Package selinux-policy.noarch 0:3.13.1-252.el7.1 will be an update</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=============================================================================================================================================================================================================================================</span><br><span class="line"> Package                                                              Arch                                            Version                                                     Repository                                            Size</span><br><span class="line">=============================================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> ceph                                                                 x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          3.0 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> libconfig                                                            x86_64                                          1.4.9-5.el7                                                 base                                                  59 k</span><br><span class="line"> liboath                                                              x86_64                                          2.6.2-1.el7                                                 epel                                                  51 k</span><br><span class="line"> librabbitmq                                                          x86_64                                          0.8.0-2.el7                                                 base                                                  37 k</span><br><span class="line"> librdmacm                                                            x86_64                                          22.1-3.el7                                                  base                                                  63 k</span><br><span class="line"> libstoragemgmt                                                       x86_64                                          1.7.3-3.el7                                                 base                                                 243 k</span><br><span class="line"> libstoragemgmt-python                                                noarch                                          1.7.3-3.el7                                                 base                                                 167 k</span><br><span class="line"> libstoragemgmt-python-clibs                                          x86_64                                          1.7.3-3.el7                                                 base                                                  19 k</span><br><span class="line"> python-ceph-argparse                                                 x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           36 k</span><br><span class="line"> python-cffi                                                          x86_64                                          1.6.0-5.el7                                                 base                                                 218 k</span><br><span class="line"> python-ply                                                           noarch                                          3.4-11.el7                                                  base                                                 123 k</span><br><span class="line"> python-pycparser                                                     noarch                                          2.14-1.el7                                                  base                                                 104 k</span><br><span class="line"> python2-bcrypt                                                       x86_64                                          3.1.6-2.el7                                                 epel                                                  39 k</span><br><span class="line"> python2-six                                                          noarch                                          1.9.0-0.el7                                                 epel                                                 2.9 k</span><br><span class="line"> yajl                                                                 x86_64                                          2.0.4-4.el7                                                 base                                                  39 k</span><br><span class="line">Updating for dependencies:</span><br><span class="line"> ceph-base                                                            x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          5.4 M</span><br><span class="line"> ceph-common                                                          x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           18 M</span><br><span class="line"> ceph-mds                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.8 M</span><br><span class="line"> ceph-mgr                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.5 M</span><br><span class="line"> ceph-mon                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          4.5 M</span><br><span class="line"> ceph-osd                                                             x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           16 M</span><br><span class="line"> ceph-radosgw                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          5.3 M</span><br><span class="line"> ceph-selinux                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           21 k</span><br><span class="line"> libcephfs2                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          480 k</span><br><span class="line"> librados2                                                            x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          3.3 M</span><br><span class="line"> libradosstriper1                                                     x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          342 k</span><br><span class="line"> librbd1                                                              x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          1.6 M</span><br><span class="line"> librgw2                                                              x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          4.6 M</span><br><span class="line"> python-cephfs                                                        x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           91 k</span><br><span class="line"> python-rados                                                         x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          190 k</span><br><span class="line"> python-rbd                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                          171 k</span><br><span class="line"> python-rgw                                                           x86_64                                          2:14.2.4-0.el7                                              ceph_stable                                           76 k</span><br><span class="line"> selinux-policy                                                       noarch                                          3.13.1-252.el7.1                                            updates                                              492 k</span><br><span class="line"> selinux-policy-targeted                                              noarch                                          3.13.1-252.el7.1                                            updates                                              7.0 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=============================================================================================================================================================================================================================================</span><br><span class="line">Install  1 Package  (+14 Dependent packages)</span><br><span class="line">Upgrade             ( 19 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 72 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">Delta RPMs disabled because /usr/bin/applydeltarpm not installed.</span><br><span class="line">(1/34): ceph-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                                  | 3.0 kB  00:00:00     </span><br><span class="line">(2/34): ceph-common-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           |  18 MB  00:00:19     </span><br><span class="line">(3/34): ceph-mds-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.8 MB  00:00:01     </span><br><span class="line">(4/34): ceph-mgr-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.5 MB  00:00:03     </span><br><span class="line">(5/34): ceph-mon-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 4.5 MB  00:00:05     </span><br><span class="line">(6/34): ceph-osd-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              |  16 MB  00:00:14     </span><br><span class="line">(7/34): ceph-radosgw-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                          | 5.3 MB  00:00:07     </span><br><span class="line">(8/34): ceph-selinux-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                          |  21 kB  00:00:00     </span><br><span class="line">(9/34): libconfig-1.4.9-5.el7.x86_64.rpm                                                                                                                                                                              |  59 kB  00:00:00     </span><br><span class="line">(10/34): librabbitmq-0.8.0-2.el7.x86_64.rpm                                                                                                                                                                           |  37 kB  00:00:00     </span><br><span class="line">(11/34): libcephfs2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           | 480 kB  00:00:00     </span><br><span class="line">(12/34): librados2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                            | 3.3 MB  00:00:05     </span><br><span class="line">(13/34): libradosstriper1-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                     | 342 kB  00:00:00     </span><br><span class="line">(14/34): librdmacm-22.1-3.el7.x86_64.rpm                                                                                                                                                                              |  63 kB  00:00:00     </span><br><span class="line">(15/34): liboath-2.6.2-1.el7.x86_64.rpm                                                                                                                                                                               |  51 kB  00:00:07     </span><br><span class="line">(16/34): librbd1-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 1.6 MB  00:00:01     </span><br><span class="line">(17/34): libstoragemgmt-python-1.7.3-3.el7.noarch.rpm                                                                                                                                                                 | 167 kB  00:00:00     </span><br><span class="line">(18/34): libstoragemgmt-1.7.3-3.el7.x86_64.rpm                                                                                                                                                                        | 243 kB  00:00:00     </span><br><span class="line">(19/34): libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64.rpm                                                                                                                                                           |  19 kB  00:00:00     </span><br><span class="line">(20/34): librgw2-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                              | 4.6 MB  00:00:02     </span><br><span class="line">(21/34): python-ceph-argparse-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                 |  36 kB  00:00:00     </span><br><span class="line">(22/34): python-ply-3.4-11.el7.noarch.rpm                                                                                                                                                                             | 123 kB  00:00:00     </span><br><span class="line">(23/34): python-cffi-1.6.0-5.el7.x86_64.rpm                                                                                                                                                                           | 218 kB  00:00:00     </span><br><span class="line">(24/34): python-cephfs-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                        |  91 kB  00:00:00     </span><br><span class="line">(25/34): python-pycparser-2.14-1.el7.noarch.rpm                                                                                                                                                                       | 104 kB  00:00:00     </span><br><span class="line">(26/34): python-rados-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                         | 190 kB  00:00:00     </span><br><span class="line">(27/34): python-rbd-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           | 171 kB  00:00:00     </span><br><span class="line">(28/34): python2-six-1.9.0-0.el7.noarch.rpm                                                                                                                                                                           | 2.9 kB  00:00:00     </span><br><span class="line">(29/34): python2-bcrypt-3.1.6-2.el7.x86_64.rpm                                                                                                                                                                        |  39 kB  00:00:00     </span><br><span class="line">(30/34): python-rgw-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                           |  76 kB  00:00:00     </span><br><span class="line">(31/34): selinux-policy-3.13.1-252.el7.1.noarch.rpm                                                                                                                                                                   | 492 kB  00:00:00     </span><br><span class="line">(32/34): yajl-2.0.4-4.el7.x86_64.rpm                                                                                                                                                                                  |  39 kB  00:00:00     </span><br><span class="line">(33/34): selinux-policy-targeted-3.13.1-252.el7.1.noarch.rpm                                                                                                                                                          | 7.0 MB  00:00:02     </span><br><span class="line">(34/34): ceph-base-14.2.4-0.el7.x86_64.rpm                                                                                                                                                                            | 5.4 MB  00:01:13     </span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                                                        1.0 MB/s |  72 MB  00:01:13     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : librdmacm-22.1-3.el7.x86_64                                                                                                                                                                                              1/53 </span><br><span class="line">  Updating   : 2:librados2-14.2.4-0.el7.x86_64                                                                                                                                                                                          2/53 </span><br><span class="line">  Updating   : 2:python-rados-14.2.4-0.el7.x86_64                                                                                                                                                                                       3/53 </span><br><span class="line">  Installing : liboath-2.6.2-1.el7.x86_64                                                                                                                                                                                               4/53 </span><br><span class="line">  Updating   : 2:librbd1-14.2.4-0.el7.x86_64                                                                                                                                                                                            5/53 </span><br><span class="line">  Updating   : 2:libcephfs2-14.2.4-0.el7.x86_64                                                                                                                                                                                         6/53 </span><br><span class="line">  Installing : librabbitmq-0.8.0-2.el7.x86_64                                                                                                                                                                                           7/53 </span><br><span class="line">  Updating   : 2:librgw2-14.2.4-0.el7.x86_64                                                                                                                                                                                            8/53 </span><br><span class="line">  Installing : 2:python-ceph-argparse-14.2.4-0.el7.x86_64                                                                                                                                                                               9/53 </span><br><span class="line">  Installing : yajl-2.0.4-4.el7.x86_64                                                                                                                                                                                                 10/53 </span><br><span class="line">  Updating   : 2:python-cephfs-14.2.4-0.el7.x86_64                                                                                                                                                                                     11/53 </span><br><span class="line">  Updating   : 2:python-rgw-14.2.4-0.el7.x86_64                                                                                                                                                                                        12/53 </span><br><span class="line">  Updating   : 2:python-rbd-14.2.4-0.el7.x86_64                                                                                                                                                                                        13/53 </span><br><span class="line">  Updating   : 2:libradosstriper1-14.2.4-0.el7.x86_64                                                                                                                                                                                  14/53 </span><br><span class="line">  Updating   : 2:ceph-common-14.2.4-0.el7.x86_64                                                                                                                                                                                       15/53 </span><br><span class="line">  Updating   : selinux-policy-3.13.1-252.el7.1.noarch                                                                                                                                                                                  16/53 </span><br><span class="line">  Updating   : selinux-policy-targeted-3.13.1-252.el7.1.noarch                                                                                                                                                                         17/53 </span><br><span class="line">  Updating   : 2:ceph-base-14.2.4-0.el7.x86_64                                                                                                                                                                                         18/53 </span><br><span class="line">  Updating   : 2:ceph-selinux-14.2.4-0.el7.x86_64                                                                                                                                                                                      19/53 </span><br><span class="line">  Updating   : 2:ceph-mds-14.2.4-0.el7.x86_64                                                                                                                                                                                          20/53 </span><br><span class="line">  Updating   : 2:ceph-mon-14.2.4-0.el7.x86_64                                                                                                                                                                                          21/53 </span><br><span class="line">  Installing : libconfig-1.4.9-5.el7.x86_64                                                                                                                                                                                            22/53 </span><br><span class="line">  Installing : libstoragemgmt-1.7.3-3.el7.x86_64                                                                                                                                                                                       23/53 </span><br><span class="line">  Installing : libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64                                                                                                                                                                          24/53 </span><br><span class="line">  Installing : libstoragemgmt-python-1.7.3-3.el7.noarch                                                                                                                                                                                25/53 </span><br><span class="line">  Updating   : 2:ceph-osd-14.2.4-0.el7.x86_64                                                                                                                                                                                          26/53 </span><br><span class="line">  Installing : python-ply-3.4-11.el7.noarch                                                                                                                                                                                            27/53 </span><br><span class="line">  Installing : python-pycparser-2.14-1.el7.noarch                                                                                                                                                                                      28/53 </span><br><span class="line">  Installing : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                                                                          29/53 </span><br><span class="line">  Installing : python2-six-1.9.0-0.el7.noarch                                                                                                                                                                                          30/53 </span><br><span class="line">  Installing : python2-bcrypt-3.1.6-2.el7.x86_64                                                                                                                                                                                       31/53 </span><br><span class="line">  Updating   : 2:ceph-mgr-14.2.4-0.el7.x86_64                                                                                                                                                                                          32/53 </span><br><span class="line">  Installing : 2:ceph-14.2.4-0.el7.x86_64                                                                                                                                                                                              33/53 </span><br><span class="line">  Updating   : 2:ceph-radosgw-14.2.4-0.el7.x86_64                                                                                                                                                                                      34/53 </span><br><span class="line">  Cleanup    : 2:ceph-radosgw-12.2.12-0.el7.x86_64                                                                                                                                                                                     35/53 </span><br><span class="line">  Cleanup    : 2:ceph-mon-12.2.12-0.el7.x86_64                                                                                                                                                                                         36/53 </span><br><span class="line">  Cleanup    : 2:ceph-osd-12.2.12-0.el7.x86_64                                                                                                                                                                                         37/53 </span><br><span class="line">  Cleanup    : 2:ceph-mds-12.2.12-0.el7.x86_64                                                                                                                                                                                         38/53 </span><br><span class="line">  Cleanup    : 2:ceph-mgr-12.2.12-0.el7.x86_64                                                                                                                                                                                         39/53 </span><br><span class="line">  Cleanup    : 2:ceph-selinux-12.2.12-0.el7.x86_64                                                                                                                                                                                     40/53 </span><br><span class="line">  Cleanup    : 2:ceph-base-12.2.12-0.el7.x86_64                                                                                                                                                                                        41/53 </span><br><span class="line">  Cleanup    : selinux-policy-targeted-3.13.1-229.el7.noarch                                                                                                                                                                           42/53 </span><br><span class="line">  Cleanup    : 2:ceph-common-12.2.12-0.el7.x86_64                                                                                                                                                                                      43/53 </span><br><span class="line">  Cleanup    : selinux-policy-3.13.1-229.el7.noarch                                                                                                                                                                                    44/53 </span><br><span class="line">  Cleanup    : 2:python-rbd-12.2.12-0.el7.x86_64                                                                                                                                                                                       45/53 </span><br><span class="line">  Cleanup    : 2:python-rgw-12.2.12-0.el7.x86_64                                                                                                                                                                                       46/53 </span><br><span class="line">  Cleanup    : 2:librgw2-12.2.12-0.el7.x86_64                                                                                                                                                                                          47/53 </span><br><span class="line">  Cleanup    : 2:python-rados-12.2.12-0.el7.x86_64                                                                                                                                                                                     48/53 </span><br><span class="line">  Cleanup    : 2:librbd1-12.2.12-0.el7.x86_64                                                                                                                                                                                          49/53 </span><br><span class="line">  Cleanup    : 2:libradosstriper1-12.2.12-0.el7.x86_64                                                                                                                                                                                 50/53 </span><br><span class="line">  Cleanup    : 2:python-cephfs-12.2.12-0.el7.x86_64                                                                                                                                                                                    51/53 </span><br><span class="line">  Cleanup    : 2:libcephfs2-12.2.12-0.el7.x86_64                                                                                                                                                                                       52/53 </span><br><span class="line">  Cleanup    : 2:librados2-12.2.12-0.el7.x86_64                                                                                                                                                                                        53/53 </span><br><span class="line">  Verifying  : 2:librados2-14.2.4-0.el7.x86_64                                                                                                                                                                                          1/53 </span><br><span class="line">  Verifying  : liboath-2.6.2-1.el7.x86_64                                                                                                                                                                                               2/53 </span><br><span class="line">  Verifying  : 2:python-rgw-14.2.4-0.el7.x86_64                                                                                                                                                                                         3/53 </span><br><span class="line">  Verifying  : python2-six-1.9.0-0.el7.noarch                                                                                                                                                                                           4/53 </span><br><span class="line">  Verifying  : 2:ceph-14.2.4-0.el7.x86_64                                                                                                                                                                                               5/53 </span><br><span class="line">  Verifying  : 2:ceph-mgr-14.2.4-0.el7.x86_64                                                                                                                                                                                           6/53 </span><br><span class="line">  Verifying  : python2-bcrypt-3.1.6-2.el7.x86_64                                                                                                                                                                                        7/53 </span><br><span class="line">  Verifying  : 2:ceph-osd-14.2.4-0.el7.x86_64                                                                                                                                                                                           8/53 </span><br><span class="line">  Verifying  : libstoragemgmt-python-clibs-1.7.3-3.el7.x86_64                                                                                                                                                                           9/53 </span><br><span class="line">  Verifying  : 2:ceph-base-14.2.4-0.el7.x86_64                                                                                                                                                                                         10/53 </span><br><span class="line">  Verifying  : 2:ceph-common-14.2.4-0.el7.x86_64                                                                                                                                                                                       11/53 </span><br><span class="line">  Verifying  : 2:libradosstriper1-14.2.4-0.el7.x86_64                                                                                                                                                                                  12/53 </span><br><span class="line">  Verifying  : 2:python-rados-14.2.4-0.el7.x86_64                                                                                                                                                                                      13/53 </span><br><span class="line">  Verifying  : 2:librbd1-14.2.4-0.el7.x86_64                                                                                                                                                                                           14/53 </span><br><span class="line">  Verifying  : librdmacm-22.1-3.el7.x86_64                                                                                                                                                                                             15/53 </span><br><span class="line">  Verifying  : libstoragemgmt-python-1.7.3-3.el7.noarch                                                                                                                                                                                16/53 </span><br><span class="line">  Verifying  : 2:ceph-mds-14.2.4-0.el7.x86_64                                                                                                                                                                                          17/53 </span><br><span class="line">  Verifying  : python-ply-3.4-11.el7.noarch                                                                                                                                                                                            18/53 </span><br><span class="line">  Verifying  : 2:libcephfs2-14.2.4-0.el7.x86_64                                                                                                                                                                                        19/53 </span><br><span class="line">  Verifying  : libconfig-1.4.9-5.el7.x86_64                                                                                                                                                                                            20/53 </span><br><span class="line">  Verifying  : 2:ceph-selinux-14.2.4-0.el7.x86_64                                                                                                                                                                                      21/53 </span><br><span class="line">  Verifying  : 2:ceph-radosgw-14.2.4-0.el7.x86_64                                                                                                                                                                                      22/53 </span><br><span class="line">  Verifying  : selinux-policy-targeted-3.13.1-252.el7.1.noarch                                                                                                                                                                         23/53 </span><br><span class="line">  Verifying  : 2:ceph-mon-14.2.4-0.el7.x86_64                                                                                                                                                                                          24/53 </span><br><span class="line">  Verifying  : yajl-2.0.4-4.el7.x86_64                                                                                                                                                                                                 25/53 </span><br><span class="line">  Verifying  : 2:librgw2-14.2.4-0.el7.x86_64                                                                                                                                                                                           26/53 </span><br><span class="line">  Verifying  : python-cffi-1.6.0-5.el7.x86_64                                                                                                                                                                                          27/53 </span><br><span class="line">  Verifying  : python-pycparser-2.14-1.el7.noarch                                                                                                                                                                                      28/53 </span><br><span class="line">  Verifying  : libstoragemgmt-1.7.3-3.el7.x86_64                                                                                                                                                                                       29/53 </span><br><span class="line">  Verifying  : 2:python-rbd-14.2.4-0.el7.x86_64                                                                                                                                                                                        30/53 </span><br><span class="line">  Verifying  : 2:python-cephfs-14.2.4-0.el7.x86_64                                                                                                                                                                                     31/53 </span><br><span class="line">  Verifying  : selinux-policy-3.13.1-252.el7.1.noarch                                                                                                                                                                                  32/53 </span><br><span class="line">  Verifying  : 2:python-ceph-argparse-14.2.4-0.el7.x86_64                                                                                                                                                                              33/53 </span><br><span class="line">  Verifying  : librabbitmq-0.8.0-2.el7.x86_64                                                                                                                                                                                          34/53 </span><br><span class="line">  Verifying  : selinux-policy-targeted-3.13.1-229.el7.noarch                                                                                                                                                                           35/53 </span><br><span class="line">  Verifying  : 2:ceph-mgr-12.2.12-0.el7.x86_64                                                                                                                                                                                         36/53 </span><br><span class="line">  Verifying  : 2:ceph-osd-12.2.12-0.el7.x86_64                                                                                                                                                                                         37/53 </span><br><span class="line">  Verifying  : selinux-policy-3.13.1-229.el7.noarch                                                                                                                                                                                    38/53 </span><br><span class="line">  Verifying  : 2:ceph-base-12.2.12-0.el7.x86_64                                                                                                                                                                                        39/53 </span><br><span class="line">  Verifying  : 2:python-rados-12.2.12-0.el7.x86_64                                                                                                                                                                                     40/53 </span><br><span class="line">  Verifying  : 2:python-cephfs-12.2.12-0.el7.x86_64                                                                                                                                                                                    41/53 </span><br><span class="line">  Verifying  : 2:ceph-common-12.2.12-0.el7.x86_64                                                                                                                                                                                      42/53 </span><br><span class="line">  Verifying  : 2:ceph-mon-12.2.12-0.el7.x86_64                                                                                                                                                                                         43/53 </span><br><span class="line">  Verifying  : 2:libradosstriper1-12.2.12-0.el7.x86_64                                                                                                                                                                                 44/53 </span><br><span class="line">  Verifying  : 2:libcephfs2-12.2.12-0.el7.x86_64                                                                                                                                                                                       45/53 </span><br><span class="line">  Verifying  : 2:python-rbd-12.2.12-0.el7.x86_64                                                                                                                                                                                       46/53 </span><br><span class="line">  Verifying  : 2:librbd1-12.2.12-0.el7.x86_64                                                                                                                                                                                          47/53 </span><br><span class="line">  Verifying  : 2:ceph-radosgw-12.2.12-0.el7.x86_64                                                                                                                                                                                     48/53 </span><br><span class="line">  Verifying  : 2:ceph-mds-12.2.12-0.el7.x86_64                                                                                                                                                                                         49/53 </span><br><span class="line">  Verifying  : 2:librgw2-12.2.12-0.el7.x86_64                                                                                                                                                                                          50/53 </span><br><span class="line">  Verifying  : 2:ceph-selinux-12.2.12-0.el7.x86_64                                                                                                                                                                                     51/53 </span><br><span class="line">  Verifying  : 2:python-rgw-12.2.12-0.el7.x86_64                                                                                                                                                                                       52/53 </span><br><span class="line">  Verifying  : 2:librados2-12.2.12-0.el7.x86_64                                                                                                                                                                                        53/53 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ceph.x86_64 2:14.2.4-0.el7                                                                                                                                                                                                                 </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  libconfig.x86_64 0:1.4.9-5.el7                   liboath.x86_64 0:2.6.2-1.el7                           librabbitmq.x86_64 0:0.8.0-2.el7                 librdmacm.x86_64 0:22.1-3.el7          libstoragemgmt.x86_64 0:1.7.3-3.el7      </span><br><span class="line">  libstoragemgmt-python.noarch 0:1.7.3-3.el7       libstoragemgmt-python-clibs.x86_64 0:1.7.3-3.el7       python-ceph-argparse.x86_64 2:14.2.4-0.el7       python-cffi.x86_64 0:1.6.0-5.el7       python-ply.noarch 0:3.4-11.el7           </span><br><span class="line">  python-pycparser.noarch 0:2.14-1.el7             python2-bcrypt.x86_64 0:3.1.6-2.el7                    python2-six.noarch 0:1.9.0-0.el7                 yajl.x86_64 0:2.0.4-4.el7             </span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  ceph-base.x86_64 2:14.2.4-0.el7                   ceph-common.x86_64 2:14.2.4-0.el7   ceph-mds.x86_64 2:14.2.4-0.el7     ceph-mgr.x86_64 2:14.2.4-0.el7   ceph-mon.x86_64 2:14.2.4-0.el7         ceph-osd.x86_64 2:14.2.4-0.el7          </span><br><span class="line">  ceph-radosgw.x86_64 2:14.2.4-0.el7                ceph-selinux.x86_64 2:14.2.4-0.el7  libcephfs2.x86_64 2:14.2.4-0.el7   librados2.x86_64 2:14.2.4-0.el7  libradosstriper1.x86_64 2:14.2.4-0.el7 librbd1.x86_64 2:14.2.4-0.el7           </span><br><span class="line">  librgw2.x86_64 2:14.2.4-0.el7                     python-cephfs.x86_64 2:14.2.4-0.el7 python-rados.x86_64 2:14.2.4-0.el7 python-rbd.x86_64 2:14.2.4-0.el7 python-rgw.x86_64 2:14.2.4-0.el7       selinux-policy.noarch 0:3.13.1-252.el7.1</span><br><span class="line">  selinux-policy-targeted.noarch 0:3.13.1-252.el7.1</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<p>5、检查更新后的rpm packages</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# rpm -qa | grep ceph</span><br><span class="line">python-ceph-argparse-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mon-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-14.2.4-0.el7.x86_64</span><br><span class="line">libcephfs2-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-base-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mds-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-osd-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-mgr-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-radosgw-14.2.4-0.el7.x86_64</span><br><span class="line">python-cephfs-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-common-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-selinux-14.2.4-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rbd</span><br><span class="line">librbd1-14.2.4-0.el7.x86_64</span><br><span class="line">python-rbd-14.2.4-0.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@ceph2 ~]# rpm -qa | grep rados</span><br><span class="line">librados2-14.2.4-0.el7.x86_64</span><br><span class="line">libradosstriper1-14.2.4-0.el7.x86_64</span><br><span class="line">ceph-radosgw-14.2.4-0.el7.x86_64</span><br><span class="line">python-rados-14.2.4-0.el7.x86_64</span><br></pre></td></tr></table></figure>
<p>6、重启服务每台ceph节点的ceph service并检查service状态</p>
<p>重启顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、Ceph Monitors</span><br><span class="line">2、Ceph Mgr</span><br><span class="line">3、Ceph OSD Daemons</span><br><span class="line">4、Ceph Metadata Servers</span><br><span class="line">5、Ceph Object Gateways</span><br></pre></td></tr></table></figure>
<p>重启命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># 重启Ceph Monitors</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mon@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph mon stat</span><br><span class="line">e1: 3 mons at &#123;ceph1=10.20.10.8:6789/0,ceph2=10.20.10.21:6789/0,ceph3=10.20.10.15:6789/0&#125;, election epoch 6, leader 0 ceph1, quorum 0,1,2 ceph1,ceph3,ceph2</span><br><span class="line"></span><br><span class="line"># 重启Ceph Mgr</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mgr@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1/1/1 up  &#123;0=ceph2=up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB / 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"></span><br><span class="line"># 重启Ceph OSD Daemons</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-osd@2.service &amp;&amp; systemctl restart ceph-osd@5.service &amp;&amp; ceph osd stat</span><br><span class="line">6 osds: 5 up, 6 in</span><br><span class="line">[root@ceph2 ~]# ceph osd stat</span><br><span class="line">6 osds: 6 up, 6 in</span><br><span class="line"></span><br><span class="line"># 重启Ceph Metadata Servers</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-mds@ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph mds stat</span><br><span class="line">cephfs-1/1/1 up  &#123;0=ceph2=up:reconnect&#125;, 1 up:standby</span><br><span class="line">[root@ceph2 ~]# ceph mds stat</span><br><span class="line">cephfs-1/1/1 up  &#123;0=ceph2=up:active&#125;, 1 up:standby</span><br><span class="line"></span><br><span class="line"># 重启Ceph Object Gateways</span><br><span class="line">[root@ceph2 ~]# systemctl restart ceph-radosgw@rgw.ceph2.service</span><br><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            insufficient standby MDS daemons available</span><br><span class="line">            noout flag(s) set</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2</span><br><span class="line">    mgr: ceph1(active), standbys: ceph3, ceph2</span><br><span class="line">    mds: cephfs-1/1/1 up  &#123;0=ceph2=up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 2 daemons active</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.30KiB</span><br><span class="line">    usage:   6.05GiB used, 293GiB / 299GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<p><code>注意</code>：当集群升级过程中，刚刚升级第一个MDS会出现<code>insufficient standby MDS daemons available</code>，当升级第二个MDS后，警告会自动消失。</p>
<p>7、警告解除<code>Legacy BlueStore stats reporting detected on 6 OSD(s)</code></p>
<p>首先确认集群状态，无其他异常告警，并修复。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            noout flag(s) set</span><br><span class="line">            Legacy BlueStore stats reporting detected on 6 OSD(s)</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 111s)</span><br><span class="line">    mgr: ceph2(active, since 6h), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs:1 &#123;0=ceph2=up:active&#125; 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">         flags noout</span><br><span class="line">    rgw: 3 daemons active (ceph1, ceph2, ceph3)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.8 KiB</span><br><span class="line">    usage:   6.1 GiB used, 293 GiB / 299 GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br><span class="line"></span><br><span class="line">[root@ceph1 ~]# systemctl stop ceph-osd@1.service</span><br><span class="line">[root@ceph1 ~]# ceph-bluestore-tool repair --path /var/lib/ceph/osd/ceph-1/</span><br><span class="line">repair success</span><br><span class="line">[root@ceph1 ~]# systemctl start ceph-osd@1.service</span><br></pre></td></tr></table></figure>
<p><code>当前出现问题：https://tracker.ceph.com/issues/42297，正在与社区沟通</code></p>
<p>相关ceph users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://lists.ceph.com/pipermail/ceph-users-ceph.com/2019-July/035889.html</span><br><span class="line">http://lists.ceph.com/pipermail/ceph-users-ceph.com/2019-July/036010.html</span><br><span class="line">http://lists.ceph.com/pipermail/ceph-users-ceph.com/2019-July/036002.html</span><br></pre></td></tr></table></figure>
<p>8、告警解除<code>3 monitors have not enabled msgr2</code>（nautilus版本中mon需要打开v2，监听3300端口），关于msgr2参见<a href="http://lnsyyj.github.io/2019/10/14/Ceph-MESSENGER-V2/" target="_blank" rel="noopener">http://lnsyyj.github.io/2019/10/14/Ceph-MESSENGER-V2/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# ceph mon enable-msgr2</span><br></pre></td></tr></table></figure>
<p>9、解除noout标志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph osd unset noout</span><br></pre></td></tr></table></figure>
<p>10、确认ceph状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph2 ~]# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     c4051efa-1997-43ef-8497-fb02bdf08233</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph1,ceph3,ceph2 (age 30m)</span><br><span class="line">    mgr: ceph2(active, since 7h), standbys: ceph3, ceph1</span><br><span class="line">    mds: cephfs:1 &#123;0=ceph2=up:active&#125; 2 up:standby</span><br><span class="line">    osd: 6 osds: 6 up, 6 in</span><br><span class="line">    rgw: 3 daemons active (ceph1, ceph2, ceph3)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   7 pools, 176 pgs</span><br><span class="line">    objects: 245 objects, 5.8 KiB</span><br><span class="line">    usage:   6.1 GiB used, 293 GiB / 299 GiB avail</span><br><span class="line">    pgs:     176 active+clean</span><br></pre></td></tr></table></figure>
<h2 id="升级Ceph客户端package"><a href="#升级Ceph客户端package" class="headerlink" title="升级Ceph客户端package"></a>升级Ceph客户端package</h2><h3 id="升级可能带来的影响-1"><a href="#升级可能带来的影响-1" class="headerlink" title="升级可能带来的影响"></a>升级可能带来的影响</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）客户端升级可能会影响客户业务，导致业务中断一定时间。</span><br><span class="line">（2）可能带来客户端程序不兼容ceph client package的情况。</span><br></pre></td></tr></table></figure>
<p>1、升级package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph1 ~]# yum install ceph-common librados2 librbd1 python-rbd python-rados -y</span><br></pre></td></tr></table></figure>
<p>2、确认升级后的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph --version</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">

      
      


      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/109/">109</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jiang Yu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiang Yu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
